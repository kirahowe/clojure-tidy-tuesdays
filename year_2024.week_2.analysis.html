<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Clojure Tidy Tuesdays - 3&nbsp; Week 2 - Canadian NHL Hockey Player Birth Months</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./year_2024.week_1.analysis.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="icon" href="data:,">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./year_2024.week_2.analysis.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 2 - Canadian NHL Hockey Player Birth Months</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Clojure Tidy Tuesdays</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Welcome to Clojure Tidy Tuesdays!</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./year_2024.week_1.analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Week 1 - Holiday Movies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./year_2024.week_2.analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 2 - Canadian NHL Hockey Player Birth Months</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#canadian-birth-months" id="toc-canadian-birth-months" class="nav-link active" data-scroll-target="#canadian-birth-months"><span class="header-section-number">3.1</span> Canadian Birth Months</a></li>
  <li><a href="#canadian-nhl-hockey-player-birth-months" id="toc-canadian-nhl-hockey-player-birth-months" class="nav-link" data-scroll-target="#canadian-nhl-hockey-player-birth-months"><span class="header-section-number">3.2</span> Canadian NHL Hockey Player Birth Months</a></li>
  <li><a href="#comparing-all-canadian-births-to-canadian-nhl-player-births" id="toc-comparing-all-canadian-births-to-canadian-nhl-player-births" class="nav-link" data-scroll-target="#comparing-all-canadian-births-to-canadian-nhl-player-births"><span class="header-section-number">3.3</span> Comparing all Canadian births to Canadian NHL player births</a></li>
  <li><a href="#chi-squared-test" id="toc-chi-squared-test" class="nav-link" data-scroll-target="#chi-squared-test"><span class="header-section-number">3.4</span> Chi-squared test</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 2 - Canadian NHL Hockey Player Birth Months</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<style></style>
<style>.printedClojure .sourceCode {
  background-color: transparent;
  border-style: none;
}
</style>
<script src="year_2024.week_2.analysis_files/md-default3.js" type="text/javascript"></script>
<script src="year_2024.week_2.analysis_files/md-default4.js" type="text/javascript"></script>
<script src="year_2024.week_2.analysis_files/vega5.js" type="text/javascript"></script>
<script src="year_2024.week_2.analysis_files/vega6.js" type="text/javascript"></script>
<script src="year_2024.week_2.analysis_files/vega7.js" type="text/javascript"></script>
<div class="sourceClojure">
<div class="sourceCode" id="cb1"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">ns</span> year<span class="fl">-2024.</span>week<span class="fl">-2.</span>analysis</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  (<span class="at">:require</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>   [aerial.hanami.templates <span class="at">:as</span> ht]</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>   [clojure.string <span class="at">:as</span> <span class="kw">str</span>]</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>   [scicloj.noj.v1.vis.hanami <span class="at">:as</span> hanami]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>   [tablecloth.api <span class="at">:as</span> tc])</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  (<span class="at">:import</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>   java.<span class="kw">time</span>.Month))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is a fun one. For this week’s #tidytuesday adventure, we’re looking at Canadian NHL hockey player birth months. It’s no secret up here that hockey players are disproportionately born in the earlier months of the year. It’s anecdotally obvious to anyone who’s ever been on or around a hockey team. We’ll explore some data this week to see if the data backs up this observation, though.</p>
<p>We’re mostly recreating the analysis done in <a href="https://jlaw.netlify.app/2023/12/04/are-birth-dates-still-destiny-for-canadian-nhl-players/">this great article on NHL player birth months</a>. The author makes a reasonable point that although it’s obvious (and I agree) to any Canadian that there are way more January-to-March birthdays on any hockey team, it’s not necessarily obvious whether this is expected or not. Basically by analysing this data we’re trying to explore the relationship between Canadian hockey player birth months and Canadian birth months in general. Are there just more Canadians born in the first months of the year for some reason? We’ll see!</p>
<section id="canadian-birth-months" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="canadian-birth-months"><span class="header-section-number">3.1</span> Canadian Birth Months</h2>
<p>The data for this analysis are gathered from the NHL API and StatsCan. There are a bunch of files saved in <a href="https://github.com/kiramclean/clojure-tidy-tuesdays/tree/main/data/year_2024/week_2"><code>data/year_2024/week_2</code></a> you can just use, or if you want to explore how the data is collected and cleaned up you can check out <a href="https://github.com/kiramclean/clojure-tidy-tuesdays/blob/main/data/year_2024/week_2/generate_dataset.clj"><code>data/year_2024/week_2/generate_dataset.clj</code></a>. We start with data on all Canadian births from 1991-2022 to see the distribution of Canadian births by month.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb2"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> canadian-births-by-month</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">-&gt;</span> <span class="st">"data/year_2024/week_2/canada_births_1991_2022.csv"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>      (tc/dataset {<span class="at">:key-fn</span> <span class="kw">keyword</span>})</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      <span class="co">;; group them by month</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>      (tc/group-by [<span class="at">:month</span>])</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      <span class="co">;; count all births per month over the time period</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>      (tc/aggregate {<span class="at">:country-births</span> #(<span class="kw">reduce</span> <span class="kw">+</span> (<span class="at">:births</span> <span class="va">%</span>))})</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">;; make a new column for the percentage of total births that each monthly total represents</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">as-&gt;</span> country-births-ds</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>            (<span class="kw">let</span> [total-births (<span class="kw">-&gt;&gt;</span> country-births-ds</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">:country-births</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                                    (<span class="kw">reduce</span> <span class="kw">+</span>))]</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>              (tc/map-columns country-births-ds</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                              <span class="at">:country-pct</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                              <span class="at">:country-births</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                              (<span class="kw">fn</span> [country-births]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                                (<span class="kw">-&gt;</span> country-births</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                                    (<span class="kw">/</span> total-births)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="kw">double</span>)))))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb3"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>canadian-births-by-month</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>_unnamed [12 3]:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: right;">:month</th>
<th style="text-align: right;">:country-births</th>
<th style="text-align: right;">:country-pct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">941370</td>
<td style="text-align: right;">0.08015265</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">886150</td>
<td style="text-align: right;">0.07545096</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">995978</td>
<td style="text-align: right;">0.08480224</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">983363</td>
<td style="text-align: right;">0.08372814</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">1029538</td>
<td style="text-align: right;">0.08765969</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1001064</td>
<td style="text-align: right;">0.08523528</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">1042392</td>
<td style="text-align: right;">0.08875414</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">1024021</td>
<td style="text-align: right;">0.08718995</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">1019490</td>
<td style="text-align: right;">0.08680416</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">982729</td>
<td style="text-align: right;">0.08367415</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">918434</td>
<td style="text-align: right;">0.07819978</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">920185</td>
<td style="text-align: right;">0.07834886</td>
</tr>
</tbody>
</table>
<p>We can plot this to make it easier to interpret:</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb4"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">-&gt;</span> canadian-births-by-month</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    (hanami/plot (<span class="kw">assoc</span> ht/layer-chart <span class="at">:encoding</span> <span class="at">:ENCODING</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                 {<span class="at">:TITLE</span> <span class="st">"Canadian births by month 1991-2022"</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">:X</span> <span class="at">:country-births</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">:XTITLE</span> <span class="st">"Number of births (cumulatively)"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                  <span class="co">;; vega-lite uses JS sorting, which does not sort numbers</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                  <span class="co">;; properly, so we'll tell it what order to use explicitly</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">:YSORT</span> [<span class="st">"1"</span> <span class="st">"2"</span> <span class="st">"3"</span> <span class="st">"4"</span> <span class="st">"5"</span> <span class="st">"6"</span> <span class="st">"7"</span> <span class="st">"8"</span> <span class="st">"9"</span> <span class="st">"10"</span> <span class="st">"11"</span> <span class="st">"12"</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">:Y</span> <span class="at">:month</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">:YTITLE</span> <span class="st">"Month"</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">:YTYPE</span> <span class="st">"nominal"</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">:LAYER</span> [{<span class="at">:mark</span> <span class="st">"bar"</span>}</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                          {<span class="at">:mark</span> {<span class="at">:type</span> <span class="st">"text"</span> <span class="at">:align</span> <span class="st">"left"</span> <span class="at">:dx</span> <span class="dv">3</span>}</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">:encoding</span> {<span class="at">:text</span> {<span class="at">:field</span> <span class="at">:country-pct</span> <span class="at">:format</span> <span class="st">".1%"</span>}}}]}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="max-height:600px;overflow-y:auto;">
<div>
<script>vegaEmbed(document.currentScript.parentElement, {"encoding":{"y":{"field":"month","type":"nominal","axis":{"title":"Month"},"sort":["1","2","3","4","5","6","7","8","9","10","11","12"]},"x":{"field":"country-births","type":"quantitative","axis":{"title":"Number of births (cumulatively)"}}},"width":400,"background":"floralwhite","title":{"text":"Canadian births by month 1991-2022"},"layer":[{"mark":"bar"},{"mark":{"type":"text","align":"left","dx":3},"encoding":{"text":{"field":"country-pct","format":".1%"}}}],"height":300,"data":{"url":"year_2024.week_2.analysis_files\/0.csv","format":{"type":"csv"}}});</script>
</div>
</div>
<p>So now we can see the distribution of births in Canada by month between 1991 and 2022. It actually looks like Canadians are less likely to be born in the earlier months of the year, with the most births in May, July, August, and September. We can compare this to the expected distribution (if each day had an exactly equal chance of being someone’s birthday) by first constructing a dataset of the “expected” monthly distributions:</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb5"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> expected-births-by-month</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [months [<span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span> <span class="dv">11</span> <span class="dv">12</span>]]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    (tc/dataset {<span class="at">:month</span> months</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">:expected-births</span> (<span class="kw">map</span> (<span class="kw">fn</span> [month]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                                         (<span class="kw">double</span> (<span class="kw">cond</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                                                   (#{<span class="dv">4</span> <span class="dv">6</span> <span class="dv">9</span> <span class="dv">11</span>} month) <span class="fl">30/365</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                                                   (<span class="kw">=</span> month <span class="dv">2</span>) <span class="fl">28/365</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">:else</span> <span class="fl">31/365</span>)))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                                       months)})))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then computing the differences between the “expected” monthly births and the actual Canadian data:</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb6"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">-&gt;</span> expected-births-by-month</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    (tc/inner-join canadian-births-by-month <span class="at">:month</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    (tc/map-columns <span class="at">:difference</span> [<span class="at">:expected-births</span> <span class="at">:country-pct</span>]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                    (<span class="kw">fn</span> [expected country]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                      (<span class="kw">-</span> expected country))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>inner-join [12 5]:</p>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 25%">
<col style="width: 24%">
<col style="width: 20%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">:month</th>
<th style="text-align: right;">:expected-births</th>
<th style="text-align: right;">:country-births</th>
<th style="text-align: right;">:country-pct</th>
<th style="text-align: right;">:difference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.08493151</td>
<td style="text-align: right;">941370</td>
<td style="text-align: right;">0.08015265</td>
<td style="text-align: right;">0.00477885</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.07671233</td>
<td style="text-align: right;">886150</td>
<td style="text-align: right;">0.07545096</td>
<td style="text-align: right;">0.00126136</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.08493151</td>
<td style="text-align: right;">995978</td>
<td style="text-align: right;">0.08480224</td>
<td style="text-align: right;">0.00012927</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.08219178</td>
<td style="text-align: right;">983363</td>
<td style="text-align: right;">0.08372814</td>
<td style="text-align: right;">-0.00153635</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.08493151</td>
<td style="text-align: right;">1029538</td>
<td style="text-align: right;">0.08765969</td>
<td style="text-align: right;">-0.00272818</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.08219178</td>
<td style="text-align: right;">1001064</td>
<td style="text-align: right;">0.08523528</td>
<td style="text-align: right;">-0.00304350</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.08493151</td>
<td style="text-align: right;">1042392</td>
<td style="text-align: right;">0.08875414</td>
<td style="text-align: right;">-0.00382263</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.08493151</td>
<td style="text-align: right;">1024021</td>
<td style="text-align: right;">0.08718995</td>
<td style="text-align: right;">-0.00225844</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.08219178</td>
<td style="text-align: right;">1019490</td>
<td style="text-align: right;">0.08680416</td>
<td style="text-align: right;">-0.00461238</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.08493151</td>
<td style="text-align: right;">982729</td>
<td style="text-align: right;">0.08367415</td>
<td style="text-align: right;">0.00125735</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.08219178</td>
<td style="text-align: right;">918434</td>
<td style="text-align: right;">0.07819978</td>
<td style="text-align: right;">0.00399201</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.08493151</td>
<td style="text-align: right;">920185</td>
<td style="text-align: right;">0.07834886</td>
<td style="text-align: right;">0.00658264</td>
</tr>
</tbody>
</table>
<p>We can check the distribution for hockey players next.</p>
</section>
<section id="canadian-nhl-hockey-player-birth-months" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="canadian-nhl-hockey-player-birth-months"><span class="header-section-number">3.2</span> Canadian NHL Hockey Player Birth Months</h2>
<p>We have a dataset that includes player info for all NHL players over all time. We’ll start by doing a similar breakdown to the one we did above for all Canadians.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb7"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> nhl-player-births-by-month</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">;; first, load the dataset:</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">-&gt;</span> <span class="st">"data/year_2024/week_2/nhl-player-births.csv"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>      (tc/dataset {<span class="at">:key-fn</span> <span class="kw">keyword</span>})</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">;; filter out just Canadian players</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>      (tc/select-rows #(<span class="kw">=</span> (<span class="at">:birth-country</span> <span class="va">%</span>) <span class="st">"CAN"</span>))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      <span class="co">;; group the players by birth month</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      (tc/group-by [<span class="at">:birth-month</span>])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">;; count the number of players per month</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      (tc/aggregate {<span class="at">:births</span> tc/row-count})</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="co">;; we'll add a new column where we compute the percentage of births that each monthly total represents</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">as-&gt;</span> player-births-ds</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>          (<span class="kw">let</span> [total-births (<span class="kw">-&gt;&gt;</span> player-births-ds</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">:births</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                                  (<span class="kw">reduce</span> <span class="kw">+</span>))]</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>            (tc/map-columns player-births-ds</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                            <span class="at">:player-pct</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                            <span class="at">:births</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                            (<span class="kw">fn</span> [births]</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>                              (<span class="kw">-&gt;</span> births</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>                                  (<span class="kw">/</span> total-births)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>                                  <span class="kw">double</span>)))))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can make a similar bar chart to see how the distribution of hockey player births compares to the all-Canada data:</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb8"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(hanami/plot nhl-player-births-by-month</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>             (<span class="kw">assoc</span> ht/layer-chart <span class="at">:encoding</span> <span class="at">:ENCODING</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>             {<span class="at">:TITLE</span> <span class="st">"NHL player births by month"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">:X</span> <span class="at">:births</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">:XTITLE</span> <span class="st">"Number of births"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>              <span class="co">;; vega-lite uses JS sorting, which does not sort numbers properly, so we'll tell it what order to use explicitly</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">:YSORT</span> [<span class="st">"JANUARY"</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"FEBRUARY"</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"MARCH"</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"APRIL"</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"MAY"</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"JUNE"</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"JULY"</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"AUGUST"</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"SEPTEMBER"</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"OCTOBER"</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"NOVEMBER"</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"DECEMBER"</span>]</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">:Y</span> <span class="at">:birth-month</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">:YTITLE</span> <span class="st">"Month"</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">:YTYPE</span> <span class="st">"nominal"</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">:LAYER</span> [{<span class="at">:mark</span> <span class="st">"bar"</span>}</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                      {<span class="at">:mark</span> {<span class="at">:type</span> <span class="st">"text"</span> <span class="at">:align</span> <span class="st">"left"</span> <span class="at">:dx</span> <span class="dv">3</span>}</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">:encoding</span> {<span class="at">:text</span> {<span class="at">:field</span> <span class="at">:player-pct</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">:format</span> <span class="st">".1%"</span>}}}]})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="max-height:600px;overflow-y:auto;">
<div>
<script>vegaEmbed(document.currentScript.parentElement, {"encoding":{"y":{"field":"birth-month","type":"nominal","axis":{"title":"Month"},"sort":["JANUARY","FEBRUARY","MARCH","APRIL","MAY","JUNE","JULY","AUGUST","SEPTEMBER","OCTOBER","NOVEMBER","DECEMBER"]},"x":{"field":"births","type":"quantitative","axis":{"title":"Number of births"}}},"width":400,"background":"floralwhite","title":{"text":"NHL player births by month"},"layer":[{"mark":"bar"},{"mark":{"type":"text","align":"left","dx":3},"encoding":{"text":{"field":"player-pct","format":".1%"}}}],"height":300,"data":{"url":"year_2024.week_2.analysis_files\/1.csv","format":{"type":"csv"}}});</script>
</div>
</div>
<p>These are definitely more distributed disproportionately through the early months of the year. We can compare them on top of each other to see more clearly next.</p>
</section>
<section id="comparing-all-canadian-births-to-canadian-nhl-player-births" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="comparing-all-canadian-births-to-canadian-nhl-player-births"><span class="header-section-number">3.3</span> Comparing all Canadian births to Canadian NHL player births</h2>
<p>We’ll simplify and combine the datasets first, before visualizing them:</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb9"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> combined-births-by-month</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [canada-births (<span class="kw">-&gt;</span> canadian-births-by-month</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                        <span class="co">;; clean up the month names so they are the same in both datasets</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                          (tc/update-columns {<span class="at">:month</span> (<span class="kw">fn</span> [col]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                                                       (<span class="kw">map</span> #(<span class="kw">-&gt;</span> <span class="va">%</span> Month/of .<span class="kw">name</span> str/capitalize)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                                                            col))}))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        player-births (<span class="kw">-&gt;</span> nhl-player-births-by-month</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                          (tc/rename-columns {<span class="at">:birth-month</span> <span class="at">:month</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">:births</span> <span class="at">:player-births</span>})</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                          (tc/update-columns {<span class="at">:month</span> (<span class="kw">partial</span> <span class="kw">map</span> str/capitalize)}))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        expected-births (<span class="kw">-&gt;</span> expected-births-by-month</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                            (tc/rename-columns {<span class="at">:expected-births</span> <span class="at">:expected-births-pct</span>})</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                            (tc/update-columns {<span class="at">:month</span> (<span class="kw">fn</span> [col]</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                                                         (<span class="kw">map</span> #(<span class="kw">-&gt;</span> <span class="va">%</span> Month/of .<span class="kw">name</span> str/capitalize)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                                                              col))}))]</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">;; join the datasets by month to make one dataset:</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">-&gt;</span> canada-births</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        (tc/inner-join player-births <span class="at">:month</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        (tc/inner-join expected-births <span class="at">:month</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The visualization in the linked article is a really great example of where ggplot really shines. I think it would be cool to explore how this might be possible to re-create with vega-lite (via the tools and wrappers we have around it Clojure), but for now we can visualize the data in a more simple way using a grouped bar chart. Since this is a pretty custom chart, I’m going to hand-write the vega-lite spec. There’s tons to learn about vega-lite, but the main takeaway for now is that you can pass any vega-lite (or vega) spec to Clojure’s vega-viz wrappers and it will render them:</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb10"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(hanami/plot combined-births-by-month</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>             {<span class="at">:data</span> {<span class="at">:values</span> <span class="at">:DATA</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">:format</span> <span class="at">:DFMT</span>}</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">:repeat</span> {<span class="at">:layer</span> [<span class="at">:expected-births-pct</span> <span class="at">:country-pct</span> <span class="at">:player-pct</span>]}</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">:spec</span> {<span class="at">:encoding</span> {<span class="at">:y</span> {<span class="at">:field</span> <span class="at">:month</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">:type</span> <span class="st">"nominal"</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">:axis</span> {<span class="at">:title</span> <span class="st">"Month"</span>}</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">:sort</span> [<span class="st">"January"</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"February"</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"March"</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"April"</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"May"</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"June"</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"July"</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"August"</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"September"</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"October"</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"November"</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"December"</span>]}}</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">:layer</span> [{<span class="at">:mark</span> <span class="st">"bar"</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                              <span class="at">:height</span> {<span class="at">:step</span> <span class="st">"12"</span>}</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                              <span class="at">:encoding</span> {<span class="at">:x</span> {<span class="at">:field</span> {<span class="at">:repeat</span> <span class="st">"layer"</span>}</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">:type</span> <span class="st">"quantitative"</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">:axis</span> {<span class="at">:title</span> <span class="st">"Percentage of births"</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">:format</span> <span class="st">".0%"</span>}}</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">:color</span> {<span class="at">:datum</span> {<span class="at">:repeat</span> <span class="st">"layer"</span>}</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">:type</span> <span class="st">"nominal"</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">:scale</span> {<span class="at">:range</span> [<span class="st">"steelblue"</span> <span class="st">"red"</span> <span class="st">"black"</span>]}</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">:legend</span> {<span class="at">:title</span> <span class="st">"Group"</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">:labelExpr</span> <span class="st">"{'country-pct': 'Canada', 'player-pct': 'NHL Players', 'expected-births-pct': 'Expected'}[datum.label]"</span>}}</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">:yOffset</span> {<span class="at">:datum</span> {<span class="at">:repeat</span> <span class="st">"layer"</span>}}}}</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>                             {<span class="at">:mark</span> {<span class="at">:type</span> <span class="st">"text"</span> <span class="at">:dx</span> -<span class="dv">80</span> <span class="at">:fontSize</span> <span class="fl">10.5</span>}</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>                              <span class="at">:encoding</span> {<span class="at">:text</span> {<span class="at">:field</span> {<span class="at">:repeat</span> <span class="st">"layer"</span>} <span class="at">:format</span> <span class="st">".1%"</span>}</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">:color</span> {<span class="at">:value</span> <span class="st">"white"</span>}</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">:yOffset</span> {<span class="at">:datum</span> {<span class="at">:repeat</span> <span class="st">"layer"</span>}}}}]}}</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>             {})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="max-height:600px;overflow-y:auto;">
<div>
<script>vegaEmbed(document.currentScript.parentElement, {"data":{"url":"year_2024.week_2.analysis_files\/2.csv","format":{"type":"csv"}},"repeat":{"layer":["expected-births-pct","country-pct","player-pct"]},"spec":{"encoding":{"y":{"field":"month","type":"nominal","axis":{"title":"Month"},"sort":["January","February","March","April","May","June","July","August","September","October","November","December"]}},"layer":[{"mark":"bar","height":{"step":"12"},"encoding":{"x":{"field":{"repeat":"layer"},"type":"quantitative","axis":{"title":"Percentage of births","format":".0%"}},"color":{"datum":{"repeat":"layer"},"type":"nominal","scale":{"range":["steelblue","red","black"]},"legend":{"title":"Group","labelExpr":"{'country-pct': 'Canada', 'player-pct': 'NHL Players', 'expected-births-pct': 'Expected'}[datum.label]"}},"yOffset":{"datum":{"repeat":"layer"}}}},{"mark":{"type":"text","dx":-80,"fontSize":10.5},"encoding":{"text":{"field":{"repeat":"layer"},"format":".1%"},"color":{"value":"white"},"yOffset":{"datum":{"repeat":"layer"}}}}]}});</script>
</div>
</div>
<p>When the data are all side-by-side like this we can see pretty clearly that it’s true that NHL players are in fact more likely to be born in the earlier parts of the year.</p>
</section>
<section id="chi-squared-test" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="chi-squared-test"><span class="header-section-number">3.4</span> Chi-squared test</h2>
<p>The last thing the author of the original article does is a chi-squared test on the NHL player births distribution. A chi-squared test is one you can use to see whether a given variable follows a hypothesized distribution in a more quantitative way, so it’s basically a more stats-y way to show that the NHL player birth dates distribution is different than we would expect. I.e., it can answer, quantitatively, the question “what are the chances that a sample of birth dates would be distributed the way our NHL player birth dates dataset is, compared to the expected distribution?” In this case our “expected” distribution is based on the distribution by month of all Canadian births.</p>
<p>In Clojure, this test is already implemented in the <a href="https://github.com/generateme/fastmath">fastmath</a> library, but in the interest of teaching (and because I already did it the hard way first before I learned how to use the fastmath function), we can just do it manually.</p>
<p>First we compute the chi statistic. The formula is <span class="math display">\[\sum_{k=1}^{n}\frac{(O_k - E_k)^2}{E_k}\]</span> where O is the actual value and E is the expected one. We can implement this in Clojure. The first thing we need is the expected values. Our “actual” values are the count of NHL player births by month, so we can compute the expected ones by applying the expected distribution (based on the Canadian births data):</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb11"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> actual-and-expected-births</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">;; first get the total count of player births</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> [total-player-births (<span class="kw">-&gt;&gt;</span> (tc/select-columns nhl-player-births-by-month [<span class="at">:births</span>])</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                                 tc/rows</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                                 (<span class="kw">map</span> <span class="kw">first</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                                 (<span class="kw">reduce</span> <span class="kw">+</span>))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">;; clean up the month names so they are the same in both datasets</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        canada-births (<span class="kw">-&gt;</span> canadian-births-by-month</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                          (tc/update-columns {<span class="at">:month</span> (<span class="kw">fn</span> [col]</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                                                       (<span class="kw">map</span> #(<span class="kw">-&gt;</span> <span class="va">%</span> Month/of .<span class="kw">name</span> str/capitalize)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                                                            col))}))]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">;; combine the Canadian data with the NHL player data to calculate the expected values</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">-&gt;</span> nhl-player-births-by-month</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        (tc/rename-columns {<span class="at">:birth-month</span> <span class="at">:month</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                            <span class="at">:births</span> <span class="at">:actual</span>})</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        (tc/update-columns {<span class="at">:month</span> (<span class="kw">partial</span> <span class="kw">map</span> str/capitalize)})</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        (tc/inner-join canada-births <span class="at">:month</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        (tc/map-columns <span class="at">:expected</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                        [<span class="at">:country-pct</span>]</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                        (<span class="kw">fn</span> [pct]</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>                          (Math/round (<span class="kw">*</span> pct total-player-births))))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        (tc/select-columns [<span class="at">:month</span> <span class="at">:actual</span> <span class="at">:expected</span>]))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb12"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>actual-and-expected-births</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>inner-join [12 3]:</p>
<table class="table">
<thead>
<tr class="header">
<th>:month</th>
<th style="text-align: right;">:actual</th>
<th style="text-align: right;">:expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>January</td>
<td style="text-align: right;">542</td>
<td style="text-align: right;">438</td>
</tr>
<tr class="even">
<td>February</td>
<td style="text-align: right;">533</td>
<td style="text-align: right;">412</td>
</tr>
<tr class="odd">
<td>March</td>
<td style="text-align: right;">513</td>
<td style="text-align: right;">464</td>
</tr>
<tr class="even">
<td>April</td>
<td style="text-align: right;">526</td>
<td style="text-align: right;">458</td>
</tr>
<tr class="odd">
<td>May</td>
<td style="text-align: right;">520</td>
<td style="text-align: right;">479</td>
</tr>
<tr class="even">
<td>June</td>
<td style="text-align: right;">463</td>
<td style="text-align: right;">466</td>
</tr>
<tr class="odd">
<td>July</td>
<td style="text-align: right;">437</td>
<td style="text-align: right;">485</td>
</tr>
<tr class="even">
<td>August</td>
<td style="text-align: right;">394</td>
<td style="text-align: right;">477</td>
</tr>
<tr class="odd">
<td>September</td>
<td style="text-align: right;">421</td>
<td style="text-align: right;">475</td>
</tr>
<tr class="even">
<td>October</td>
<td style="text-align: right;">383</td>
<td style="text-align: right;">457</td>
</tr>
<tr class="odd">
<td>November</td>
<td style="text-align: right;">374</td>
<td style="text-align: right;">428</td>
</tr>
<tr class="even">
<td>December</td>
<td style="text-align: right;">361</td>
<td style="text-align: right;">428</td>
</tr>
</tbody>
</table>
<p>This gives us the expected values – the number of births we would expect per month if we randomly sampled the same number of births from the Canadian data as we have NHL player births. Now we can compute the chi squared statistic:</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb13"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> chi-squared</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">-&gt;&gt;</span> (tc/select-columns actual-and-expected-births [<span class="at">:actual</span> <span class="at">:expected</span>])</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>       tc/rows</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>       (<span class="kw">map</span> (<span class="kw">fn</span> [[actual expected]]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>              <span class="co">;; find the difference between the actual and expected values</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>              (<span class="kw">let</span> [a-e (<span class="kw">-</span> actual expected)]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                (<span class="kw">-&gt;</span> a-e</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                    <span class="co">;; square it</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                    (<span class="kw">*</span> a-e)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                    <span class="co">;; divide it by the expected value</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                    (<span class="kw">/</span> expected)))))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>       <span class="co">;; sum them</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>       (<span class="kw">reduce</span> <span class="kw">+</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>       <span class="co">;; make it a number instead of a fraction</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>       <span class="kw">double</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>       Math/round))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb14"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>chi-squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb15"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dv">134</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to use this value to test whether our NHL player birth dates follow an “expected” distribution, we can calculate the P-value using a chi-squared distribution. This is also implemented in fastmath, in this case we’ll use it. The P value tells us what the probability is of observing the given discrepancy between the actual and expected values. The degrees of freedom is one less than the number of categories we have, so in our case 11.</p>
<div class="sourceClojure">
<div class="sourceCode" id="cb16"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">require</span> '[fastmath.stats <span class="at">:as</span> stats])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb17"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">require</span> '[fastmath.random <span class="at">:as</span> r])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceClojure">
<div class="sourceCode" id="cb18"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>(stats/p-value (r/distribution <span class="at">:chi-squared</span> {<span class="at">:degrees-of-freedom</span> <span class="dv">11</span>}) chi-squared)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="printedClojure">
<div class="sourceCode" id="cb19"><pre class="sourceCode clojure code-with-copy"><code class="sourceCode clojure"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Interpreting this, we can say there is a 0.0% chance that the NHL player birth data are sampled from the Canadian birth data. In other words, the probability that the NHL player birth distribution by month is a fluke is 0. It’s definitely anomalous, not a result of not having a large enough sample size.</p>
<p>So that wraps up our exploration of this data! I’d love to poke around some more and see how the distribution of NHL players by nationality breaks down over time, and play around with vega-lite some more to make cooler looking graphs. But here I am already late for next week’s tidy tuesday, so I’ll move on for now and come back once I’ve learned more.</p>
<p>See you next week :)</p>
<div style="background-color:grey;height:2px;width:100%;">

</div>
<div>
<pre><small><small>source: <a href="https://github.com/kiramclean/clojure-tidy-tuesdays/blob/main/src/year_2024/week_2/analysis.clj">src/year_2024/week_2/analysis.clj</a></small></small></pre>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./year_2024.week_1.analysis.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Week 1 - Holiday Movies</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>