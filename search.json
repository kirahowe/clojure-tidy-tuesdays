[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Clojure Tidy Tuesdays",
    "section": "",
    "text": "(ns index)\n\n\n1 Welcome to Clojure Tidy Tuesdays!\nThis is a collection of #TidyTuesday explorations in Clojure. Tidy tuesdays are an initiative of the R for data science online learning community, and as a Clojure enthusiast, I’m publishing implementations of the data-generation scripts and data explorations in Clojure here in 2024. Follow along to learn all about Clojure’s rich data ecosystem!\n\n\n\n\nsource: src/index.clj"
  },
  {
    "objectID": "year_2024.week_1.analysis.html#making-a-bar-chart",
    "href": "year_2024.week_1.analysis.html#making-a-bar-chart",
    "title": "2  Week 1 - Holiday Movies",
    "section": "2.1 Making a bar chart",
    "text": "2.1 Making a bar chart\nTo get started, we’ll load the data into our notebook, starting with the dataset of holiday movies:\n\n(def holiday-movies\n  (tc/dataset \"data/year_2024/week_1/holiday-movies.csv\"))\n\nWe’ll make a graph that’s similar to the one in this article about Christmas movies, showing the top 20 movies by number of votes. For this we’ll use noj, a library that nicely integrates hanami, a Clojure library that wraps vega-lite, with tablecloth. First we can tell it to make a bar chart:\n\n(-&gt; holiday-movies\n    ;; sort the movies by number of votes\n    (tc/order-by \"num_votes\" :desc)\n    ;; select the first 20\n    (tc/select-rows (range 20))\n    ;; make a bar chart\n    (hanami/plot ht/bar-chart {}))\n\n\n\n\n\n\nWe have to tell hanami what values to use in the chart and what they are:\n\n(-&gt; holiday-movies\n    (tc/order-by \"num_votes\" :desc)\n    (tc/select-rows (range 20))\n    (hanami/plot ht/bar-chart {:X \"num_votes\"\n                               :Y \"primary_title\"\n                               :YTYPE \"nominal\"}))\n\n\n\n\n\n\nThis works! We’ll give it a few more options to tidy up the chart, like sorting the bars by number of votes rather than alphabetically and re-labelling the axes:\n\n(-&gt; holiday-movies\n    (tc/order-by \"num_votes\" :desc)\n    (tc/select-rows (range 20))\n    (hanami/plot ht/bar-chart {:X \"num_votes\"\n                               :Y \"primary_title\"\n                               :YTYPE \"nominal\"\n                               :YTITLE \"Title\"\n                               :XTITLE \"Number of votes\"\n                               :YSORT \"-x\"}))"
  },
  {
    "objectID": "year_2024.week_1.analysis.html#adding-labels-to-the-bar-chart",
    "href": "year_2024.week_1.analysis.html#adding-labels-to-the-bar-chart",
    "title": "2  Week 1 - Holiday Movies",
    "section": "2.2 Adding labels to the bar chart",
    "text": "2.2 Adding labels to the bar chart\nIn order to add the number of votes values next to the bars we’ll have to rearrange some of the vega lite spec.. making this tidier and more intuitive is on the list of projects the Clojure data community is actively working on. I get that right now it requires too much information of vega-lite internals. Also it breaks the sorting and I don’t know why yet..\n\n(-&gt; holiday-movies\n    (tc/order-by \"num_votes\" :desc)\n    (tc/select-rows (range 20))\n    (hanami/plot (assoc ht/layer-chart :encoding :ENCODING)\n                 {:TITLE \"Christmas Movies\"\n                  :X \"num_votes\"\n                  :Y \"primary_title\"\n                  :YTYPE \"nominal\"\n                  :YTITLE \"Title\"\n                  :XTITLE \"Number of votes\"\n                  :YSORT \"-x\"\n                  :WIDTH 500\n                  :XSTACK nil\n                  :LAYER [{:mark {:type \"bar\"}}\n                          {:mark {:type \"text\" :align \"left\" :baseline \"middle\" :dx 3}\n                           :encoding {:text {:field \"num_votes\"}}}]}))\n\n\n\n\n\n\nThis is a similar idea to what’s accomplished in the article. We don’t have exactly the same data, so we can’t encode the Oscar status of each movie in the colour, but we could do something else, like indicate the decade in which the film was released. There are lots of ways to accomplish this. There would be a way to tell vega-lite to do it (via Hanami), but for the sake of exploring Clojure some more we’ll do the data wrangling part with it. To do that we’ll start with our dataset of the 20 most popular movies and add a column for the release decade, then update our plot to have the bars coloured by decade.\n\n(-&gt; holiday-movies\n    (tc/order-by \"num_votes\" :desc)\n    (tc/select-rows (range 20))\n    ;; add a new column for the decade, computed from the year\n    (tc/map-columns \"decade\" [\"year\"] (fn [year]\n                                        (-&gt; year\n                                            (/ 10)\n                                            (Math/floor)\n                                            (* 10)\n                                            int\n                                            (str \"s\"))))\n    ;; colour our bars according to the decade\n    (hanami/plot ht/bar-chart {:X \"num_votes\"\n                               :Y \"primary_title\"\n                               :YTYPE \"nominal\"\n                               :YTITLE \"Title\"\n                               :XTITLE \"Number of votes\"\n                               :YSORT \"-x\"\n                               :COLOR \"decade\"}))\n\n\n\n\n\n\nWithout the bar labels, this is reasonably straightforward."
  },
  {
    "objectID": "year_2024.week_1.analysis.html#making-a-word-cloud",
    "href": "year_2024.week_1.analysis.html#making-a-word-cloud",
    "title": "2  Week 1 - Holiday Movies",
    "section": "2.3 Making a word cloud",
    "text": "2.3 Making a word cloud\nThe next graph in the article is a graph of relationships between the movie keywords. We don’t have the keywords in our dataset, but we could do something with the words of the movie titles, like a word cloud, where the size of the word reflects its occurrence in the movie titles. First we’ll collect all of the words in all the titles into a list, then use those as the data for the word cloud. This is a little more involved with low-level vega details than is ideal right now, but it’s possible.\n\n(let [data (-&gt; holiday-movies\n               (tc/select-columns \"primary_title\")\n               tc/rows\n               flatten)]\n  (kind/vega {:data\n              [{:name \"table\"\n                :values data\n                :transform\n                [{:type \"countpattern\"\n                  :field \"data\"\n                  :case \"upper\"\n                  :pattern \"[\\\\w']{3,}\"\n                  :stopwords \"(the|a|i'm|like|too|into|ing|for|where|she|he|hers|his|how|who|what|your|yours|it|it's|is|are|we|'til|our|and|but|i'll|this|that|from|with)\"\n                  }\n                 {:type \"formula\",\n                  :as \"angle\",\n                  :expr \"[-45, -25, 0, 25, 45][~~(random() * 5)]\"}\n                 {:type \"formula\",\n                  :as \"weight\",\n                  :expr \"if(datum.text=='CHRISTMAS' |\n                            datum.text=='HOLIDAY' |\n                            datum.text=='HANNUKAH', 600, 300)\"}]}],\n              :scales\n              [{:name \"color\"\n                :type \"ordinal\",\n                :domain {:data \"table\", :field \"text\"},\n                :range [\"red\" \"green\" \"grey\" \"darkred\" \"darkgreen\"]}],\n              :marks\n              [{:type \"text\",\n                :from {:data \"table\"},\n                :encode\n                {:enter\n                 {:text {:field \"text\"},\n                  :align {:value \"center\"},\n                  :baseline {:value \"alphabetic\"},\n                  :fill {:scale \"color\", :field \"text\"}},\n                 :update {:fillOpacity {:value 1}},\n                 :hover {:fillOpacity {:value 0.5}}},\n                :transform\n                [{:fontSizeRange [10 56],\n                  :type \"wordcloud\",\n                  :font \"Helvetica Neue, Arial\",\n                  :size [800 400],\n                  :padding 2,\n                  :fontWeight {:field \"datum.weight\"},\n                  :rotate {:field \"datum.angle\"},\n                  :fontSize {:field \"datum.count\"},\n                  :text {:field \"text\"}}]}]}))\n\n\n\n\n\n\n\nSee you next week :)\n\n\n\n\nsource: src/year_2024/week_1/analysis.clj"
  }
]